<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
<head>
    <title>Groups</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="hands.ico" />
    <link rel="stylesheet" href="css/bootstrap.min.css">         
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src ="js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>      
    <script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>

    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/tether.min.js"></script>

    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"></style>
    <script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script> 
</head>
<body>

    <div ng-app="myApp" ng-controller="myCtrl">
        <table>
            <td>
                <img src="CERT Logo.jpg" name="image" height="150" width="500"/>
            </td>
        </tr>
    </table>
    <nav class="navbar navbar-dark mdb-color">
        <div class="container-fluid">
                    <!--<div class="navbar-header">
                      <ul class="nav navbar-nav">
                    <!--<div class="container">
        
                    <!--Collapse content-->
                    <div class="collapse navbar-toggleable-xs" id="collapseEx">
                        <!--Navbar Brand-->
                        <!--Links-->
                        <ul class="nav navbar-nav">
                            <li class="nav-item"><a href="/Home">Home</a></li>
                            <li class="nav-item"><a href="/Reports">Reports</a></li>
                            <li class="nav-item "><a href="/Volunteers">Volunteers</a></li>
                            <li class="nav-item active"> <a href="/Groups">Groups</a></li> 
                            <li class="nav-item"><a href=aboutUs.html>About Us</a></li> 
                            <li class="nav-item"><a href=FAQ.html>FAQ's</a></li> 
                        </ul>

                        <form action ="/Login">
                           <button class="btn btn-primary btn-sm" style="float: right" type="submit">Logout</button> 
                       </form>
                   </div>     
               </div>
           </nav>    

           <div class="container">

            <div class="row"><br>
                <form class="form-inline" role="search">
                    <div class="md-form form-group">
                      <h2><strong>Groups </strong> &emsp;&emsp;&emsp;&emsp;&emsp;
                        &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                        <input type="text" class="form-control" ng-model="test" placeholder="Search">
                        
                        <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>                                                      
                    </h2>
                </div><br>
                
                <!--                        <button style="float: right" class="btn btn-primary btn-xl" data-toggle="modal" data-target="#createGroup" ><span class="fa fa-plus">&nbsp;Create Group</span></button>-->
            </form>
            
            


            <div class="col-md-12">
                <div class="table-responsive">                           
                    <table id="mytable" class="table table-bordered table-striped">
                        <thead class="thead-inverse">                                
                          <th><input type="checkbox" id="checkall"  /></th>
                          <!-- <th>Group Id</th> -->
                          <th>Group Name</th>                          
                          <th>Group Lead Mail  Id</th>
                          <th>Incident</th>
                          <th>Description</th>
                          <th>Edit</th>
                          <th>Delete</th>
                      </thead>
                      <tbody>
                        <tr ng-repeat="x in Groups| filter:test">
                            <td><input type="checkbox" class="checkthis" /></td>
                                        <!-- <td>
                                            <div ng-hide="editingData[x._id]" ng-bind="x._id"></div>
                                            <div ng-show="editingData[x._id]"><input type="text" ng-model="x._id" /></div>
                                        </td> -->
                                        <td>
                                            <div ng-hide="editingData[x._id]" ng-bind="x.gName"></div>
                                            <div ng-show="editingData[x._id]"><input type="text" ng-model="x.gName" /></div>
                                        </td>
                                        
                                        <td>
                                            <div ng-hide="editingData[x._id]" ng-bind="x.gLead"></div>
                                            <div ng-show="editingData[x._id]"><input type="text" ng-model="x.gLead" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x._id]" ng-bind="x.iName"></div>
                                            <div ng-show="editingData[x._id]"><input type="text" ng-model="x.iName" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x._id]" ng-bind="x.comments"></div>
                                            <div ng-show="editingData[x._id]"><input type="text" ng-model="x.comments" /></div>
                                        </td>
                                        <td>
                                            <button ng-hide="editingData[x._id]" ng-click="modify(x)" class="btn btn-primary btn-sm"><span class="fa fa-pencil"></span></button>
                                            <button ng-show="editingData[x._id]" ng-click="update(x)" class="btn btn-warning btn-sm"><span class="fa fa-save"></span></button></td>
                                            <td>   <button ng-hide="viewField" class="btn btn-danger btn-sm" data-title="Delete" data-toggle="modal" ng-click="delete(x)"><span class="fa fa-trash"></span></button>
                                            </td>
                                        </tr>                            



                                    </tbody>
                                </table>                            
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="fa fa-times" aria-hidden="true"></span></button>
                                    <h4 class="modal-title custom_align" id="Heading">Delete this entry</h4>
                                </div>
                                <div class="modal-body">

                                    <div class="alert alert-warning"><span class="glyphicon glyphicon-warning-sign"></span> Are you sure you want to delete this Group?</div>

                                </div>
                                <div class="modal-footer ">
                                    <button type="button" class="btn btn-success" data-dismiss="modal"><span class="fa fa-check"></span> Yes</button>
                                    <button type="button" class="btn btn-warning" data-dismiss="modal"><span class="fa fa-remove"></span> No</button>
                                </div>
                            </div>
                            <!-- /.modal-content --> 
                        </div>
                        <!-- /.modal-dialog --> 
                    </div>
                </div>
                <script>
                    var app = angular.module('myApp', []);
                    app.controller('myCtrl', ['$scope', '$http', '$window', function ($scope, $http, $location) {
                        $scope.Groups = <%- JSON.stringify(gList) %>;
                        $scope.editingData = {};

                        for (var i = 0, length = $scope.Groups.length; i < length; i++) {
                            $scope.editingData[$scope.Groups[i]._id] = false;
                        }


                        $scope.modify = function (x) {
                            $scope.editingData[x._id] = true;
                        };

                        $scope.delete = function(x){
                            var _id = x._id;
                            return $http({method: 'POST',
                                url: '/deleteGroup',
                               data: JSON.stringify({
                                _id: x._id
                            }),
                               headers: {
                                   'Content-Type': 'application/json'
                               }
                           }).success(function (response) {
                                             window.location='/Groups';  
                                             
                                         });
                        };
                        $scope.update = function (x) {
                            var _id = x._id;
                            $http({method: 'POST',
                             url: '/updateGroup',
                             data: JSON.stringify({
                                _id: x._id,
                                gName: x.gName,
                                iName: x.iName,
                                gLead: x.gLead,
                                comments: x.comments        
                            }),
                             headers: {
                                 'Content-Type': 'application/json'
                             }
                         });
                            $scope.editingData[x._id] = false;
                        };
                    }]);
                </script>
                <script>
                    $(document).ready(function () {
                        $('#mytable').dataTable(
                         { "bFilter": false, 
                         "ordering": false,
                         "lengthMenu": [ [10,  25, 50, -1], [10, 25, 50, "All"] ] });
                        $("#mytable #checkall").click(function () {
                            if ($("#mytable #checkall").is(':checked')) {
                                $("#mytable input[type=checkbox]").each(function () {
                                    $(this).prop("checked", true);
                                });

                            } else {
                                $("#mytable input[type=checkbox]").each(function () {
                                    $(this).prop("checked", false);
                                });
                            }
                        });

                        $("[data-toggle=tooltip]").tooltip();
                    });
                </script>

            </div>
        </body>
        </html>
        y