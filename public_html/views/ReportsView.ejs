<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Reports</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="hands.ico" />
        <link rel="stylesheet" href="css/bootstrap.min.css">         
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="css/style.css" />
        <!-- Material Design Bootstrap -->
        <link href="css/mdb.min.css" rel="stylesheet">
        <script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>      
        
<!--        CDN Link for generating PDF files-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.debug.js"></script>

        <!-- Bootstrap tooltips -->
        <script type="text/javascript" src="js/tether.min.js"></script>

        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" src="js/bootstrap.min.js"></script>

        <!-- MDB core JavaScript -->
        <script type="text/javascript" src="js/mdb.min.js"></script>
        <link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"></style>
        <script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>

    </head>
    <body>
        <div ng-app="myApp" ng-controller="myCtrl">
            <table>
                <td>
                    <img src="CERT Logo.jpg" name="image" height="150" width="500"/>
                </td>
                </tr>
            </table>
            <nav class="navbar navbar-dark mdb-color">
                <div class="container-fluid">
                    <!--<div class="navbar-header">
                      <ul class="nav navbar-nav">
                    <!--<div class="container">
        
                    <!--Collapse content-->
                    <div class="collapse navbar-toggleable-xs" id="collapseEx">
                        <!--Navbar Brand-->
                        <!--Links-->
                        <ul class="nav navbar-nav">
                            <li class="nav-item"><a href="/Home">Home</a></li>
                            <li class="nav-item active"><a href="/Reports">Reports</a></li>
                            <li class="nav-item"><a href="/Volunteers">Volunteers</a></li>
                            <li class="nav-item"> <a href="/Groups">Groups</a></li> 
                            <li class="nav-item"><a href=aboutUs.html>About Us</a></li> 
                            <li class="nav-item"><a href=FAQ.html>FAQ's</a></li> 
                        </ul>

                        <form action ="LoginPage.html">
                   <button class="btn btn-primary btn-sm" style="float: right" type="submit">Logout</button> 
                        </form>
                    </div>     
                </div>
            </nav>            
            <div class="container">

                <div class="row"><br>
                    <form class="form-inline" role="search">
                        <div class="md-form form-group">
                            <h2><strong> <%= JSON.stringify(incidentName) %> Reports</strong> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                            <input type="text" class="form-control" ng-model="test" placeholder="Search">
                            
                            <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>                                                      
                            </h2>
                   
                       
                        </div><br>
                        
                    </form>

                    <div class="col-md-12 filterable" >
                        <div class="table-responsive">                           
                            <table id="mytable" class="table table-bordered table-striped table">
                                <thead class="thead-inverse">
                                    <tr class="filters">
                                <th>Location</th>
                                <th>Incident name </th>
                                <th>Level Of Impact <br>
                                    <select>
                                    <option></option>
                                    <option>Low</option>
                                    <option>Medium</option>
                                    <option>High</option>
                                    </select>
                                </th>
                                <th>Reported by</th>
                                
                                <th>Cell Number</th>
                                <th> Date </th>
                                <th>Edit</th>
                                <th>Delete</th>
								<th>Full Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="x in reports| filter:test">
                                        
                                        <td>
                                            <div ng-hide="editingData[x.id]" ng-bind="x.location"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.location" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x.id]" ng-bind="x.incidentName"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.incidentName" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x.id]" ng-bind="x.levelOfImpact"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.levelOfImpact" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x.id]" ng-bind="x.userName"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.userName" /></div>
                                        </td>
                                       
                                        <td> 
                                            <div ng-hide="editingData[x.id]" ng-bind="x.contactNo"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.contactNo" /></div>
                                        </td>
                                        <td>
                                            <div ng-hide="editingData[x.id]" ng-bind="x.createdAt"></div>
                                            <div ng-show="editingData[x.id]"><input type="text" ng-model="x.createdAt" /></div>
                                        </td>
                                                                              
                                        <td>
                                            <button ng-hide="editingData[x.id]" ng-click="modify(x)" class="btn btn-primary btn-sm"><span class="fa fa-pencil"></span></button>
                                            <button ng-show="editingData[x.id]" ng-click="update(x)" class="btn btn-warning btn-sm"><span class="fa fa-check-square"></span>Update</button>
                                        </td>
                                        <td>   <button ng-hide="viewField" class="btn btn-danger btn-sm" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="fa fa-trash"></span></button>
                                        </td>
										<td class="detail_td">
                                            <p data-placement="top" data-toggle="tooltip" title="Details">
                                                <button class="detail_button btn btn-primary btn-xs dtlBtn" id="{{x._id}}" data-title="Details" data-toggle="modal" data-target="#orderDetails">Detail
                                                </button>
                                            </p>
                                        </td>
                                    </tr>                            



                                </tbody>
                            </table>                            
                        </div>
						<div id ="hide" style="display:none"></div>
                         <div class="modal fade" id="orderDetails" tabindex="-1" role="dialog" aria-labelledby="createGroup" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h3>Report Details</h3>
                                    </div>
                                    <div class="modal-body">
                                        <div id="rowDetails">
                                            <span>
                                               
                                            </span>
                                        </div>
                                    </div>
                                    <div class="modal-footer ">
                                        <button type="button" class="detail_button btn btn-primary btn-xs dtlBtn" data-dismiss="modal" aria-hidden="true" id="savePdf">Save as PDF</button>
                                        <button type="button" class="detail_button btn btn-primary btn-xs dtlBtn" data-dismiss="modal" aria-hidden="true">Close</button>
                                    </div>
                                </div>
                            </div>
                            </div>
						
                    </div>
                </div>
            <!--                report pop up div -->
                <div id="orderModal" class="modal hide fade" role="dialog" aria-labelledby="orderModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
         <h3>Order</h3>

    </div>
    <div id="orderDetails" class="modal-body"></div>
    <div id="orderItems" class="modal-body"></div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
                <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="fa fa-times" aria-hidden="true"></span></button>
                                <h4 class="modal-title custom_align" id="Heading">Delete this entry</h4>
                            </div>
                            <div class="modal-body">

                                <div class="alert alert-warning"><span class="glyphicon glyphicon-warning-sign"></span> Are you sure you want to delete this Record?</div>

                            </div>
                            <div class="modal-footer ">
                                <button type="button" class="btn btn-success glyphicon glyphicon-remove row-remove" id="yesBtn" ><span class="fa fa-check"></span>Yes</button>
                                <button type="button" class="btn btn-warning" data-dismiss="modal"><span class="fa fa-remove"></span>No</button>
                            </div>
                        </div>
                        <!-- /.modal-content --> 
                    </div>
                    <!-- /.modal-dialog --> 
                </div>
            </div>
        </div>
            
            <!--<div class="modal fade" id="create" tabindex="-1" role="dialog" aria-labelledby="create" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span class="fa fa-times" aria-hidden="true"></span></button>
                            <h4 class="modal-title custom_align" id="Heading">Report Details</h4>
                        </div>
                        <form action="/viewReport" method="post">
                            <div class="modal-body">
                                
                            </div>
                            <div class="modal-footer ">
                                <a href="./report.html"><button>Cancel</button></a>
                                <button type="submit" class="btn btn-success btn-lg" style="width: 100%;"><span class="fa fa-check-square"></span>�Download</button>
                            </div>
                        </form>
                    </div>
                    <!-- /.modal-content --> 
                <!--</div>

                <!-- /.modal-dialog --> 
            <!--</div>-->
          
            
            <script>
                var reports = []
                var app = angular.module('myApp', []);
                app.controller('myCtrl', ['$scope', '$http', '$window', function ($scope, $http, $location) {
                    $scope.reports = <%- JSON.stringify(vol) %>;
                    reports = $scope.reports;
                   // console.log(reports);
                   $scope.editingData = {};

                    for (var i = 0, length = $scope.reports.length; i < length; i++) {
                        $scope.editingData[$scope.reports[i].id] = false;
                    }


                    $scope.modify = function (x) {
                        $scope.editingData[x.id] = true;
                    };


                    $scope.update = function (x) {
    var _id = x._id;
    $http({method: 'POST',
     url: '/updateReport',
     data: JSON.stringify({
        _id: x._id,
        location: x.location,
        incidentName: x.incidentName,
        levelOfImpact: x.levelOfImpact,
        userName: x.userName,
        contactNo: x.contactNo,
        createdAt: x.createdAt
    }),
     headers: {
         'Content-Type': 'application/json'
     }
 });
    $scope.editingData[x._id] = false;
};
}]);</script>
            <script>$(document).ready(function () {
                 $('#mytable').dataTable(
                         { "bFilter": false, 
                     "ordering": false,
                     "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ] });

                    $("#mytable #checkall").click(function () {
                        if ($("#mytable #checkall").is(':checked')) {
                            $("#mytable input[type=checkbox]").each(function () {
                                $(this).prop("checked", true);
                            });

                        } else {
                            $("#mytable input[type=checkbox]").each(function () {
                                $(this).prop("checked", false);
                            });
                        }
                    

                    $("[data-toggle=tooltip]").tooltip();
                    });
                    $('#yesBtn').click(function() {
                        // handle deletion here
                       // print("Hello");
                       // var id = $('.confrimDelete').data('title');
//                        var id = 'John';
//                        $('[data-reportedBy='+id+']').parents('tr').remove();
//                        $('#delete').modal('hide');
                        var id = $('.confrimDelete').data('id');
                        $('[data-id='+id+']').parents('tr').remove();
                        $('#myModal').modal('hide');
                    });
                 $(".dtlBtn").on("click", function (evt) {
                        console.log(evt);
                        var row_id = evt.target.id;
                        
                       
                    
                    var slctdRow = {}
                    reports.forEach(function(row){
                        if(row._id==row_id){
                            slctdRow = row
                        }
                    });
                    
                    
                  //  console.log(slctdRow);
                    
                    var formHtml = "<form >";
                    
                    for( key in slctdRow){
                        if( (key != "_id" && key != "_created_at" && key != "$$hashKey" && key != "_updated_at" ))
                            formHtml += '<div class="form-group"><label for="exampleInputEmail1" class="dtl_key">'+key+': </label> <span id="'+key+'" class="dtl_value" > '+slctdRow[key]+'</span></div>';
                    }
                    
                    formHtml += "" 
                    formHtml += "</form>"
                    
                       $('#rowDetails').html(formHtml);
                    });
//generating a PDF
$('#savePdf').click(function () {
 
   // var id = $('#rowDetails').find("#id").text();
    //var location = $('#rowDetails').find("#location").val();
    var incident = $('#rowDetails').find("#incidentName").html();
console.log(incident + "value");
    //var loi = $('#rowDetails').find("#LOI").val();
    //var reportedBy = $('#rowDetails').find("#reportedBy").val();
    //var contactNo = $('#rowDetails').find("#contactNo").val();
    //var date = $('#rowDetails').find("#date").val();
    
    var doc = new jsPDF();
    doc.text(10, 10, 'Report Details ' );
    //doc.text(10, 20, 'Id : ' + id );
    doc.text(10, 30, 'Incident : ' + incident);
    //doc.text(10, 40, 'Location : ' +location );
    //doc.text(10, 50, 'LOI : ' + loi);
    //doc.text(10, 60, 'Reported By : ' + reportedBy);
    //doc.text(10, 70, 'Contact Number : ' + contactNo);
    //doc.text(10, 80, 'Date : ' + date);
    
    doc.save('Reports.pdf');
});
   
            $('.filterable .filters select').change(function(e){
                /* Ignore tab key */
            /* Useful DOM data and selectors */
            var $input = $(this),
            inputContent = $input.val(),
            $panel = $input.parents('.filterable'),
            column = $panel.find('.filters th').index($input.parents('th')),
            $table = $panel.find('.table'),
            $rows = $table.find('tbody tr');
            /* Dirtiest filter function ever ;) */
            var $filteredRows = $rows.filter(function(){
            var value = $(this).find('td').eq(column).text();
            return value.indexOf(inputContent) === -1;
        });
        
        /* Clean previous no-result if exist */
        $table.find('tbody .no-result').remove();
        /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
        $rows.show();
        
        $filteredRows.hide();
        /* Prepend no-result row if all rows are filtered */
        if ($filteredRows.length === $rows.length) {
            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
        }
        });    
    
        });
                
         </script>

    </body>
</html>
